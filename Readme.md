# Database-service

## Задание

Создайте высоконагруженное приложение на Golang, которое будет предоставлять кешированный доступ на чтение к данным из
базы данных Postgresql.

### Требования

1. Структура бд. Таблица users содержит информацию о пользователях и их уровне доступа(user или admin). Таблица data
   содержит сами данные, к которым предоставляется доступ, а также информацию о том, какому пользователю они
   принадлежат.
2. Схема - на свое усмотрение.
3. Формат API - свободный.
4. Приложение должно быть способно обрабатывать большое количество запросов одновременно. (> 100 RPS)
5. Приложение должно использовать кеширование для ускорения доступа к данным. Однако при изменении данных в базе данных
   через какое-то время данные должны обновляться
6. Приложение должно обеспечивать контроль доступа. user должен иметь доступ только в своим данным, а admin - ко всем.
   Вы можете использовать любую библиотеку для аутентификации и авторизации на ваш выбор.
7. Приложение должно поставляться в виде docker-compose файла. Вы должны предоставить инструкции по запуску приложения с
   помощью Docker.
8. Напишите тесты для вашего приложения. Вы можете использовать любую библиотеку для тестирования на ваш выбор.
9. Код должен быть хорошо структурирован и легко читаем. Вы должны следовать принципам чистого кода и использовать
   паттерны проектирования, где это необходимо.
10. Приложение должно быть готово к продакшену. Это означает, что оно должно быть стабильным, надежным и безопасным.
11. (Опционально) Предоставьте документацию для вашего приложения. Документация должна включать описание
    функциональности приложения, инструкции по запуску и использованию приложения, а также описание архитектуры
    приложения.

## Установка

1. Спуллить проект


* Раскомментировать файл `docker-compose.yml.example`
* Раскомментировать файл `config/postgres/config.env.example`
* Раскомментировать файл `config/postgres/config.env.example`
* запустить в cli `docker compose up`

## База данных

### Миграции

Для миграций используется утилита [goose](https://github.com/pressly/goose). 

Миграции расположены в каталоге /migrations, и будут применены при запуске `docker compose`

### Структура бд

#### users
| Name         |             Type              |     Comment     |
|:-------------|:-----------------------------:|:---------------:|
| Id           |         PK, BIGSERIAL         | Первичный ключ  |
| access_level | access_level(*user*\|*admin*) | Уровень доступа |

#### data
| Name    |      Type      |        Comment        |
|:--------|:--------------:|:---------------------:|
| Id      | PK, BIGSERIAL  |    Первичный ключ     |
| user_id | FK к __users__ | Связь с пользователем |
| data    |      TEXT      |  Данные пользователя  |

## Api

[Спецификация](api-specification.yaml)

## Описание приложения

### Конфигурация

#### CONFIG_PATH
Путь до конфига внутри приложения. По умолчанию "./config/database-service/config.yaml".